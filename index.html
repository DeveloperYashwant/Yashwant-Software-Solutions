<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Exam Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <video autoplay playsinline width="300" height="225"></video>
  <script>
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        document.querySelector('video').srcObject = stream;
      })
      .catch(err => {
        alert("Camera access denied or error: " + err.message);
      });
  </script>
 
 <style>
    body {
      background-color: #f8f9fa;
    }
    .question {
      font-weight: bold;
    }
    #timer {
      font-size: 1.2rem;
      color: red;
    }
    .answered {
      background-color: #d4edda;
    }
    .unanswered {
      background-color: #f8d7da;
    }
    .dark-mode {
      background-color: #212529;
      color: white;
    }
    .dark-mode .card {
      background-color: #343a40;
      color: white;
    }
  </style>
</head>
<body onload="startExam()">
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <button class="btn btn-outline-dark" onclick="toggleDarkMode()">Toggle Dark Mode</button>
      <div><strong>Welcome, <span id="studentNameDisplay"></span>!</strong></div>
    </div>
    <div class="progress mb-3">
      <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
    </div>
    <div class="card shadow">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h4 class="mb-0">Student Exam Portal</h4>
        <div id="timer"></div>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label for="language" class="form-label">Select Language:</label>
          <select id="language" class="form-select" onchange="changeLanguage()">
            <option value="C">C</option>
            <option value="C++">C++</option>
            <option value="Java">Java</option>
          </select>
        </div>
        <div id="questionBox"></div>
        <div class="d-flex justify-content-between mt-4">
          <button class="btn btn-secondary" onclick="prevQuestion()">Previous</button>
          <button class="btn btn-primary" onclick="nextQuestion()">Next</button>
          <button class="btn btn-danger" onclick="submitExam()">Submit</button>
        </div>
      </div>
    </div>

    <div class="mt-4" id="prevResult"></div>
  </div>

  <!-- Result Modal -->
  <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="resultModalLabel">Exam Result</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modalContent"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  
    const questions = {
      "C": [
        { q: "What is the output of: printf(\"%d\", 10 + 5);", options: ["15", "10", "5", "None"], answer: 0 },
        { q: "Which is valid variable in C?", options: ["int", "float", "_var", "1num"], answer: 2 }
      ],
      "C++": [
        { q: "Which of these is a correct C++ keyword?", options: ["function", "fun", "class", "def"], answer: 2 },
        { q: "How do you declare a pointer?", options: ["int* p;", "int p;", "pointer int;", "int p();"], answer: 0 }
      ],
      "Java": [
        { q: "What is the return type of main()?", options: ["void", "int", "String", "public"], answer: 0 },
        { q: "Which keyword is used to inherit a class in Java?", options: ["this", "import", "extends", "inherits"], answer: 2 }
      ]
    };

    let selectedLanguage = "C";
    let current = 0;
    let answers = [];
    let timerSeconds = 300;
    let warnings = 0;

    function startExam() {
      const name = prompt("Enter your name:");
      document.getElementById("studentNameDisplay").innerText = name || "Student";
      changeLanguage();
      startTimer();
      preventInspect();
      showPreviousResult();
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          warnings++;
          alert(`Warning ${warnings}/3: Don't switch tabs!`);
          if (warnings >= 3) submitExam();
        }
      });
      document.documentElement.requestFullscreen();
    }

    function changeLanguage() {
      selectedLanguage = document.getElementById("language").value;
      current = 0;
      answers = new Array(questions[selectedLanguage].length).fill(null);
      renderQuestion();
      updateProgress();
    }

    function renderQuestion() {
      const q = questions[selectedLanguage][current];
      const box = document.getElementById("questionBox");
      const statusClass = answers[current] !== null ? 'answered' : 'unanswered';
      box.innerHTML = `
        <div class='mb-3 question ${statusClass}'>Q${current + 1}: ${q.q}</div>
        ${q.options.map((opt, i) => `
          <div class="form-check">
            <input class="form-check-input" type="radio" name="opt" value="${i}" ${answers[current] == i ? "checked" : ""} onchange="selectOption(${i})">
            <label class="form-check-label">${opt}</label>
          </div>`).join("")}
      `;
    }

    function selectOption(i) {
      answers[current] = i;
      localStorage.setItem("examAnswers", JSON.stringify(answers));
      renderQuestion();
      updateProgress();
    }

    function nextQuestion() {
      if (current < questions[selectedLanguage].length - 1) {
        current++;
        renderQuestion();
      }
    }

    function prevQuestion() {
      if (current > 0) {
        current--;
        renderQuestion();
      }
    }

    function updateProgress() {
      const answeredCount = answers.filter(a => a !== null).length;
      const total = questions[selectedLanguage].length;
      const percent = Math.round((answeredCount / total) * 100);
      const progressBar = document.getElementById("progressBar");
      progressBar.style.width = percent + "%";
      progressBar.innerText = `${percent}%`;
    }

    function startTimer() {
      const timer = document.getElementById("timer");
      const interval = setInterval(() => {
        if (timerSeconds <= 0) {
          clearInterval(interval);
          submitExam();
        }
        let min = Math.floor(timerSeconds / 60);
        let sec = timerSeconds % 60;
        timer.innerText = `Time Left: ${min}:${sec < 10 ? "0" + sec : sec}`;
        timerSeconds--;
      }, 1000);
    }

    function submitExam() {
      const langQuestions = questions[selectedLanguage];
      let score = 0;
      langQuestions.forEach((q, i) => {
        if (answers[i] == q.answer) score++;
      });
      const review = langQuestions.map((q, i) => `Q${i + 1}: ${q.q}<br>Your Answer: ${q.options[answers[i]] || "Not Answered"}<br>Correct Answer: ${q.options[q.answer]}<br>`).join("<hr>");
      const result = {
        score,
        date: new Date().toLocaleString(),
        language: selectedLanguage
      };
      localStorage.setItem("studentResult", JSON.stringify(result));
      document.exitFullscreen();
      document.getElementById("modalContent").innerHTML = `<strong>Score in ${selectedLanguage}:</strong> ${score}/${langQuestions.length}<br><br>${review}`;
      new bootstrap.Modal(document.getElementById("resultModal")).show();
    }

    function preventInspect() {
      document.addEventListener("contextmenu", e => e.preventDefault());
      document.onkeydown = function(e) {
        if (e.key === "F12" || (e.ctrlKey && e.shiftKey && e.key === "I")) return false;
      };
    }

    function showPreviousResult() {
      const result = JSON.parse(localStorage.getItem("studentResult"));
      if (result) {
        document.getElementById("prevResult").innerHTML = `
          <div class="alert alert-info">
            <strong>Previous Result:</strong><br>
            Language: ${result.language}<br>
            Score: ${result.score}<br>
            Date: ${result.date}
          </div>
        `;
      }
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }
  </script>
</body>
</html>