<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Coding Exam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ---- RESET & BASE ---- */
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5; color:#333;
      min-height:100vh; display:flex;
      align-items:center; justify-content:center;
      transition:background .3s, color .3s;
    }
    button { cursor:pointer; transition:background .2s }

    /* ---- LOGIN CARD ---- */
    .login-card {
      background:#fff; border-radius:8px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      width:100%; max-width:400px; padding:30px;
    }
    .login-card h2 { font-size:1.75em; margin-bottom:8px; color:#222 }
    .login-card p { color:#666; margin-bottom:24px }
    .login-card label { display:block; margin-bottom:6px; font-weight:600 }
    .login-card input, .login-card select {
      width:100%; padding:12px; margin-bottom:20px;
      border:1px solid #ccc; border-radius:6px; font-size:1em;
    }
    #start-btn {
      width:100%; padding:14px; font-weight:600;
      border:none; border-radius:6px;
      background:#6c757d; color:#fff;
    }
    #start-btn.enabled {
      background:#3498db;
    }
    #start-btn.enabled:hover {
      background:#2980b9;
    }

    /* ---- MAIN CONTAINER ---- */
    .container {
      display:none; width:90%; max-width:1000px;
      background:#fff; border-radius:10px;
      box-shadow:0 8px 16px rgba(0,0,0,0.1);
      padding:30px;
    }
    .container.active { display:block }
    h2.section-title {
      text-align:center; margin-bottom:20px; color:#2b2b2b;
    }

    /* ---- EXAM LAYOUT ---- */
    #exam-section { display:flex; gap:30px }
    .question-panel { flex:1 }
    .camera-panel {
      width:320px; display:flex;
      flex-direction:column; align-items:center;
    }
    video {
      width:100%; border:2px solid #ddd;
      border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1);
    }
    #timer {
      font-size:1.3em; color:#e74c3c;
      margin-bottom:20px;
    }
    .question { margin-bottom:20px; font-size:1.1em }
    .question input { margin-right:10px }
    .nav-btn {
      background:#3498db; color:#fff;
      padding:10px 16px; margin:6px 6px 6px 0;
      border:none; border-radius:5px;
    }
    .nav-btn:hover { background:#2980b9 }
    .dark-toggle {
      background:#333!important; color:#fff!important;
    }

    /* ---- RESULTS SUMMARY ---- */
    #result-section { display:none; margin-top:20px }
    .summary-card {
      display:flex; justify-content:space-between;
      align-items:flex-start; padding:20px;
      border:1px solid #ddd; border-radius:8px;
      background:#fafafa;
    }
    .summary-left {
      flex:1; padding-right:20px;
    }
    .summary-left h3 { margin-bottom:6px }
    .summary-left p { margin-bottom:8px; color:#555 }
    .summary-actions button {
      background:#fff; color:#333; border:1px solid #333;
      padding:8px 12px; border-radius:6px;
      display:flex; align-items:center;
    }
    .summary-actions button:hover { background:#f0f0f0 }
    .summary-right {
      text-align:right;
      display:flex; flex-direction:column; align-items:flex-end;
    }
    .score-badge {
      background:#e74c3c; color:#fff;
      padding:8px 12px; border-radius:20px;
      font-weight:600; margin-bottom:8px;
    }
    .status-badge {
      background:#e74c3c; color:#fff;
      padding:6px 10px; border-radius:4px;
      font-size:.9em;
    }
    .download-btn {
      background:#000; color:#fff; margin-top:12px;
      padding:10px 16px; border:none; border-radius:6px;
    }
    .download-btn:hover { background:#333 }

    /* ---- DETAILED RESULTS ---- */
    .detailed {
      margin-top:30px;
    }
    .detailed h4 { margin-bottom:12px }
    .detail-card {
      padding:15px; border:1px solid #ddd;
      border-radius:6px; margin-bottom:15px;
      position:relative;
    }
    .detail-card h5 {
      margin-bottom:8px; font-size:1.1em;
    }
    .badge-correct, .badge-incorrect {
      position:absolute; top:15px; right:15px;
      padding:4px 8px; border-radius:4px;
      font-size:.85em; display:flex; align-items:center;
    }
    .badge-correct { background:#2ecc71; color:#fff; }
    .badge-incorrect { background:#e74c3c; color:#fff; }
    .detail-card p { margin:6px 0; }

    /* ---- DARK MODE ---- */
    .dark-mode {
      background:#18191a; color:#ddd;
    }
    .dark-mode .login-card,
    .dark-mode .container {
      background:#242526; color:#ddd;
    }
    .dark-mode input, .dark-mode select {
      background:#3a3b3c; border-color:#555; color:#ddd;
    }
    .dark-mode video { border-color:#555; }
    .dark-mode .badge-correct { background:#27ae60; }
    .dark-mode .badge-incorrect { background:#c0392b; }
  </style>
</head>
<body>

  <!-- LOGIN CARD -->
  <div class="login-card" id="login-card">
    <h2>Login to Exam</h2>
    <p>Enter your details to start the coding exam</p>
    <label>Full Name</label>
    <input type="text" id="username" placeholder="Enter your full name">
    <label>Select Course</label>
<select id="course">
  <option value="">Select a course</option>
  <option>HTML</option>
  <option>CSS</option>
  <option>JavaScript</option>
  <option>React</option>
  <option>Angular</option>
  <option>Python</option>
  <option>Java</option>
  <option>C</option>
  <option>C++</option>
  <option>C#</option>
  <option>PHP</option>
  <option>SQL</option>
  <option>Node.js</option>
  <option>Express.js</option>
  <option>MongoDB</option>
  <option>MySQL</option>
  <option>Bootstrap</option>
  <option>TypeScript</option>
  <option>Ruby</option>
  <option>Kotlin</option>
  <option>Swift</option>
</select>

    <button id="start-btn" disabled>Start Exam</button>
  </div>

  <!-- EXAM + RESULTS -->
  <div class="container" id="main-container">
    <h2 class="section-title">Coding Exam</h2>

    <!-- EXAM SCREEN -->
    <div id="exam-section">
      <div class="question-panel">
        <div id="timer">Time: 60</div>
        <div id="question-container" class="question"></div>
        <button class="nav-btn" id="prev-btn" onclick="prevQuestion()">Previous</button>
        <button class="nav-btn" id="next-btn" onclick="handleNext()">Next</button>
        <button class="nav-btn dark-toggle" onclick="toggleDarkMode()">Toggle Dark Mode</button>
      </div>
      <div class="camera-panel">
        <video id="webcam" autoplay muted playsinline></video>
      </div>
    </div>

    <!-- RESULTS SCREEN -->
    <div id="result-section">
      <div class="summary-card">
        <div class="summary-left">
          <h3>Exam Summary</h3>
          <p id="summary-name"></p>
          <p><strong>Final Score:</strong> <span id="summary-score-text"></span></p>
          <p><strong>Submission Reason:</strong> <span id="summary-reason"></span></p>
          <p><strong>Result:</strong> <span id="summary-result-text"></span></p>
          <div class="summary-actions">
            <button onclick="restartExam()">üè† Start New Exam</button>
          </div>
        </div>
        <div class="summary-right">
          <div class="score-badge" id="summary-score-badge"></div>
          <div class="status-badge" id="summary-passfail"></div>
          <button class="download-btn" onclick="downloadResults()">‚¨áÔ∏è Download Results</button>
        </div>
      </div>

      <div class="detailed">
        <h4>Detailed Results</h4>
        <div id="detailed-container"></div>
      </div>
    </div>
  </div>

  <!-- face-api.js -->
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  <script src="questions.js"></script>
  <script>
    // QUESTIONS
 
// ==========================
// STATE VARIABLES
// ==========================

// Tracks the index of the current question
let currentQuestion = 0,
// Stores user's selected answers (initially all null)
    answers = Array(questions.length).fill(null),
// Total time allowed for the exam (in seconds)
    timeLeft = 60,
// Counts how many times the face is not detected
    faceStrikes = 0,
// Counts how many times the user switches tabs
    tabSwitchCount = 0,
// Flag to indicate if the exam has been submitted
    hasSubmitted = false,
// To store the webcam video stream
    webcamStream,
// Indicates whether face detection is active
    detecting = false,
// Stores the timer interval for clearing later
    timerInterval;

// ==========================
// HTML ELEMENT REFERENCES
// ==========================

// Login card container
const loginCard    = document.getElementById('login-card'),
// Main container for the quiz after login
      mainContainer= document.getElementById('main-container'),
// Start button to begin the exam
      startBtn     = document.getElementById('start-btn'),
// Input field for entering the username
      nameInput    = document.getElementById('username'),
// Dropdown for course selection
      courseSelect = document.getElementById('course'),
// Button to go to previous question
      prevBtn      = document.getElementById('prev-btn'),
// Button to go to next question or submit
      nextBtn      = document.getElementById('next-btn');

// ==========================
// LOGIN VALIDATION
// ==========================

// Enables the Start button only when name and course are filled
function validateLogin(){
  const ok = nameInput.value.trim() && courseSelect.value;
  startBtn.disabled = !ok;
  startBtn.classList.toggle('enabled', ok);
}
// Run validation on input changes
nameInput.addEventListener('input', validateLogin);
courseSelect.addEventListener('change', validateLogin);

// Handle Start button click
startBtn.addEventListener('click', async ()=>{
  loginCard.style.display = 'none';                // Hide login
  mainContainer.classList.add('active');           // Show main exam area
  await startWebcam();                             // Start webcam access
  await faceapi.nets.tinyFaceDetector.loadFromUri( // Load face detection model
    'https://justadudewhohacks.github.io/face-api.js/models'
  );
  loadQuestion();         // Load first question
  updateNavButtons();     // Set button states
  monitorFace();          // Start monitoring face presence
  monitorTabSwitch();     // Detect tab switches
  startTimer();           // Begin countdown timer
});

// ==========================
// CAMERA SETUP
// ==========================

// Access webcam and play video stream
async function startWebcam(){
  const video = document.getElementById('webcam');
  try {
    webcamStream = await navigator.mediaDevices.getUserMedia({ video:true });
    video.srcObject = webcamStream;
    await video.play(); // Play video on the page
  } catch {
    alert("Camera access is required."); // If user denies permission
  }
}

// ==========================
// FACE MONITORING
// ==========================

// Detects if user's face is visible in front of webcam
async function monitorFace(){
  detecting = true;
  const video = document.getElementById('webcam');

  async function loop(){
    if(!detecting) return;
    const res = await faceapi.detectSingleFace(
      video, new faceapi.TinyFaceDetectorOptions()
    );
    if(!res){
      faceStrikes++;
      if(faceStrikes===1) alert("‚ö†Ô∏è Warning: Face not visible. Strike 1/3.");
      else if(faceStrikes===2)
        alert("‚ö†Ô∏è Warning: Strike 2/3. Next will auto-submit.");
      else if(faceStrikes>=3 && !hasSubmitted){
        hasSubmitted = true;
        submitExam("‚ùå Auto-submitted: Face missing 3 times.");
        stopWebcam();
        return;
      }
    } else faceStrikes=0; // Reset if face is visible again
    setTimeout(loop,1500); // Check every 1.5 seconds
  }
  loop();
}

// ==========================
// TAB SWITCH MONITORING
// ==========================

// Detects if user switches away from the tab
function monitorTabSwitch(){
  document.addEventListener('visibilitychange', ()=>{
    if(document.hidden && !hasSubmitted){
      tabSwitchCount++;
      if(tabSwitchCount===1)
        alert("‚ö†Ô∏è Warning: Switched tab. Strike 1/3.");
      else if(tabSwitchCount===2)
        alert("‚ö†Ô∏è Warning: Strike 2/3. Next will auto-submit.");
      else if(tabSwitchCount>=3 && !hasSubmitted){
        hasSubmitted = true;
        submitExam("‚ùå Auto-submitted: Switched tabs 3 times.");
      }
    }
  });
}

// ==========================
// TIMER
// ==========================

// Starts countdown timer for the exam
function startTimer(){
  const timerEl = document.getElementById('timer');
  timerInterval = setInterval(()=>{
    timeLeft--;
    timerEl.textContent = `Time: ${timeLeft}`;
    if(timeLeft<=0 && !hasSubmitted){
      clearInterval(timerInterval);
      hasSubmitted = true;
      submitExam("‚è∞ Time's up!");
    }
  }, 1000); // Update every second
}

// ==========================
// QUESTION NAVIGATION
// ==========================

// Loads current question and options
function loadQuestion(){
  const q = questions[currentQuestion],
        c = document.getElementById('question-container');
  c.innerHTML = `<strong>Q${currentQuestion+1}:</strong> ${q.question}<br>`;
  q.options.forEach((opt,i)=>{
    c.innerHTML +=
     `<label><input type="radio" name="opt" value="${i}"
       ${answers[currentQuestion]===i?'checked':''}>
       ${String.fromCharCode(65+i)}. ${opt}
      </label><br>`;
  });
  document.querySelectorAll('input[name="opt"]').forEach(inp=>{
    inp.addEventListener('change', e=>
      answers[currentQuestion] = +e.target.value
    );
  });
}

// Updates state of navigation buttons
function updateNavButtons(){
  prevBtn.disabled = currentQuestion===0;
  nextBtn.textContent =
    currentQuestion<questions.length-1 ? 'Next' : 'Submit';
}

// Go to next question or submit
function handleNext(){
  if(currentQuestion<questions.length-1){
    currentQuestion++;
    loadQuestion();
    updateNavButtons();
  } else {
    submitExam("User submitted");
  }
}

// Go to previous question
function prevQuestion(){
  if(currentQuestion>0){
    currentQuestion--;
    loadQuestion();
    updateNavButtons();
  }
}

// ==========================
// SUBMISSION & RESULTS
// ==========================

// Handles quiz submission and displays result summary
function submitExam(reason){
  stopWebcam();
  clearInterval(timerInterval);
  document.getElementById('exam-section').style.display='none';
  document.getElementById('result-section').style.display='block';

  // Summary report
  document.getElementById('summary-name')
    .textContent = `${nameInput.value.trim()} ‚Äì ${courseSelect.value} Course`;
  const score = calculateScore(),
        pct = Math.round(score/questions.length*100);
  document.getElementById('summary-score-badge')
    .textContent = `${score}/${questions.length} (${pct}%)`;
  document.getElementById('summary-score-text')
    .textContent = `${score}/${questions.length} (${pct}%)`;
  document.getElementById('summary-reason')
    .textContent = reason;
  document.getElementById('summary-passfail')
    .textContent = score===questions.length ? 'PASSED' : 'FAILED';
  document.getElementById('summary-passfail').classList.toggle(
    'badge-correct', score===questions.length
  );
  document.getElementById('summary-passfail').classList.toggle(
    'badge-incorrect', score<questions.length
  );

  // Detailed report
  const dc = document.getElementById('detailed-container');
  dc.innerHTML = '';
  questions.forEach((q,i)=>{
    const ua = answers[i]==null ? 'Not answered' : q.options[answers[i]],
          correct = q.options[q.answer];
    const card = document.createElement('div');
    card.className = 'detail-card';
    const badge = document.createElement('span');
    badge.className = answers[i]===q.answer
      ? 'badge-correct' : 'badge-incorrect';
    badge.innerHTML = answers[i]===q.answer
      ? '‚úî Correct' : '‚úñ Incorrect';
    card.appendChild(badge);
    card.innerHTML += `
      <h5>Question ${i+1}</h5>
      <p>${q.question}</p>
      <p><strong>Your Answer:</strong> ${ua}</p>
      <p><strong>Correct Answer:</strong> ${correct}</p>
    `;
    dc.appendChild(card);
  });
}

// Calculate total score
function calculateScore(){
  return answers.filter((a,i)=>a===questions[i].answer).length;
}

// ==========================
// DOWNLOAD REPORT AS TEXT FILE
// ==========================

function downloadResults() {
  const name = nameInput.value.trim();
  const course = courseSelect.value;
  const score = calculateScore();
  const total = questions.length;
  const percentage = Math.round((score / total) * 100);
  const resultText = score === questions.length ? "PASS" : "FAIL";
  const reason = document.getElementById('summary-reason').textContent;

  let txt = `========== CODING EXAM REPORT ==========\n\n`;
  txt += `Name            : ${name}\n`;
  txt += `Course          : ${course}\n`;
  txt += `Score           : ${score}/${total} (${percentage}%)\n`;
  txt += `Result          : ${resultText}\n`;
  txt += `Submission Note : ${reason}\n\n`;
  txt += `------------- DETAILED REPORT -------------\n\n`;

  questions.forEach((q, i) => {
    const ua = answers[i] == null ? "Not Answered" : q.options[answers[i]];
    const correct = q.options[q.answer];
    const status = answers[i] === q.answer ? "‚úî Correct" : "‚úñ Incorrect";
    txt += `Q${i + 1}. ${q.question}\n`;
    txt += `Your Answer     : ${ua}\n`;
    txt += `Correct Answer  : ${correct}\n`;
    txt += `Status          : ${status}\n\n`;
  });

  txt += `==========================================`;

  // Save as a file
  const blob = new Blob([txt], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'exam_results.txt';
  a.click();
}

// ==========================
// RESTART EXAM
// ==========================

// Reloads the page to restart exam
function restartExam(){ location.reload(); }

// ==========================
// DARK MODE TOGGLE
// ==========================

// Switches between light/dark mode and saves preference
function toggleDarkMode(){
  document.body.classList.toggle('dark-mode');
  localStorage.setItem(
    'darkMode', document.body.classList.contains('dark-mode')
  );
}
// Apply dark mode if it was previously set
if(localStorage.getItem('darkMode')==='true'){
    document.body.classList.add('dark-mode');
}

// ==========================
// STOP WEBCAM
// ==========================

// Stops webcam stream and face monitoring
function stopWebcam(){
  detecting=false;
  if(webcamStream) webcamStream.getTracks().forEach(t=>t.stop());
}
  </script>
</body>
</html>
